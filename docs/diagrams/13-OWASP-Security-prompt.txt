I need an OWASP Security Diagram showing the 4 main security threats and protection layers for the BookMyHome campsite booking system.

SYSTEM CONTEXT:
- .NET 9.0 ASP.NET Core application
- Blazor Server UI with MudBlazor
- REST API with JWT authentication
- MySQL 8.0 database
- Entity Framework Core with parameterized queries

Create a layered defense diagram with threats on the left and protection mechanisms on the right.

THREATS (Left side - Red boxes with warning icons):

1. SQL Injection
   Risk Level: HIGH
   Attack Vector: Malicious SQL in user input
   Example: "'; DROP TABLE Bookings; --"
   Target: Database queries

2. Cross-Site Scripting (XSS)
   Risk Level: HIGH
   Attack Vector: Malicious JavaScript in input
   Example: "<script>alert('XSS')</script>"
   Target: Web UI, user browsers

3. Cross-Site Request Forgery (CSRF)
   Risk Level: MEDIUM
   Attack Vector: Forged requests from malicious sites
   Example: Fake form submission
   Target: Authenticated user sessions

4. Broken Authentication
   Risk Level: HIGH
   Attack Vector: Weak passwords, session hijacking
   Example: Brute force, token theft
   Target: User accounts, JWT tokens

PROTECTION LAYERS (Right side - Green boxes with shield icons):

LAYER 1 - INPUT VALIDATION:
Protection against: SQL Injection, XSS

Mechanisms:
‚úÖ InputValidator.ValidateInput()
   - Regex validation
   - XSS pattern detection
   - Max length checks
   - Email format validation
   Location: Infrastructure/Security/InputValidator.cs

‚úÖ Strongly-Typed Value Objects
   - Email class validates format (normalizes to lowercase)
   - Money class validates amount (prevents negative)
   - DateRange validates dates (end > start)
   - BookingStatus validates transitions
   Location: Models/ValueObjects/

‚úÖ EF Core Parameterized Queries
   - Automatic SQL parameterization
   - No raw SQL queries (no FromSqlRaw)
   - Prevents SQL injection
   - All queries use LINQ-to-SQL

Code Example:
// SAFE - Parameterized (actual implementation)
var booking = await _context.Bookings
    .Where(b => b.Id == bookingId)
    .FirstOrDefaultAsync();

// UNSAFE - String concatenation (NOT USED in codebase)
// var sql = $"SELECT * FROM Bookings WHERE Id = '{bookingId}'";

LAYER 2 - OUTPUT ENCODING:
Protection against: XSS

Mechanisms:
‚úÖ Blazor Auto-Encoding
   - Automatic HTML encoding
   - Prevents script injection
   - Safe rendering of user input
   - @variable syntax automatically encodes

‚úÖ Input Validation via Domain Model
   - String length limits enforced
   - Special requests validation
   - Comment validation in Review entity

Code Example:
// Blazor automatically encodes this (actual implementation)
<p>@booking.SpecialRequests</p>
// Output: &lt;script&gt; becomes &lt;script&gt; (encoded)

‚ö†Ô∏è Content Security Policy (CSP)
   - Not explicitly configured in code
   - Could be added via Nginx or middleware

LAYER 3 - AUTHENTICATION & AUTHORIZATION:
Protection against: Broken Authentication

Mechanisms:
‚úÖ JWT Token Authentication
   - Secure token generation (HMAC SHA256)
   - Token expiration (24 hours)
   - Issuer/Audience validation
   - Signature verification
   Location: Controllers/AuthController.cs, Program.cs

‚úÖ Cookie Authentication
   - HttpOnly cookies
   - Secure cookies (HTTPS in production)
   - SameSite=Lax
   - Sliding expiration (8 hours default, 30 days if Remember Me)
   Location: Program.cs

‚úÖ Password Hashing
   - ASP.NET Core Identity PasswordHasher
   - Uses PBKDF2 algorithm (not BCrypt)
   - Salt per password (automatic)
   - Work factor: Default (Identity framework)
   Location: Program.cs (PasswordHasher<User>)

‚úÖ Role-Based Access Control (RBAC)
   - [Authorize] attributes on controllers
   - User type in claims (Guest, Admin, Staff)
   - JWT token contains role claims
   - Cookie authentication for Blazor UI

‚ö†Ô∏è Resource-Level Authorization
   - Not fully implemented
   - Users can access any booking (no ownership check)
   - Future enhancement needed

‚úÖ HTTPS Only
   - UseHttpsRedirection() in Program.cs
   - HSTS enabled in production
   - TLS 1.2+ required

Code Example:
[Authorize] // JWT required
public class BookingsController : ControllerBase
{
    // All endpoints require authentication
}

LAYER 4 - CSRF PROTECTION:
Protection against: CSRF

Mechanisms:
‚úÖ Anti-Forgery Tokens
   - Blazor built-in CSRF protection
   - Anti-forgery middleware enabled
   - Header name: X-CSRF-TOKEN
   - Cookie name: X-CSRF-TOKEN
   Location: Program.cs

‚úÖ SameSite Cookies
   - SameSite=Lax (for cookie auth)
   - SameSite=Strict (for CSRF token)
   - Prevents cross-site cookie sending

‚úÖ HTTPS Enforcement
   - Redirects HTTP to HTTPS
   - Secure cookie policy
   - HSTS headers

Code Example:
// Blazor automatically adds anti-forgery token
<EditForm Model="@booking" OnValidSubmit="HandleSubmit">
    <!-- Anti-forgery token automatically included -->
</EditForm>

ADDITIONAL SECURITY MEASURES:

‚ö†Ô∏è Rate Limiting
   - Not implemented in main app
   - Could be added via YARP Gateway (optional)
   - Future enhancement

‚úÖ Input Sanitization
   - Trim whitespace
   - Domain model validation
   - Value object validation

‚úÖ Logging & Monitoring
   - ILogger framework
   - Log authentication attempts
   - Log failed validations
   - Console logging

‚úÖ Secure Configuration
   - Connection strings in appsettings.json
   - JWT secret in appsettings (should be in Key Vault for production)
   - Environment-specific configuration
   - Generic error messages in production

‚úÖ Error Handling
   - Generic error messages (no information leakage)
   - Exception handling middleware
   - Development vs Production error handling

VISUAL LAYOUT:

Left side (Threats):
[SQL Injection] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> [Layer 1: Input Validation]
[XSS] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> [Layer 2: Output Encoding]
[CSRF] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> [Layer 4: CSRF Protection]
[Broken Auth] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ> [Layer 3: Authentication]

Center (Application):
[Blazor UI] ‚Üí [API] ‚Üí [Database]
[Optional: API Gateway between UI and API]

Right side (Protection):
Show shields blocking arrows from threats

LEGEND:
üî¥ Red = Threat
üü¢ Green = Protection
‚úÖ = Implemented
‚ö†Ô∏è = Partial or future enhancement
‚ùå = Not implemented
‚Üí = Attack vector
üõ°Ô∏è = Defense mechanism

OWASP TOP 10 COVERAGE:
‚úÖ A01:2021 - Broken Access Control (JWT + Cookie auth, basic RBAC)
‚ö†Ô∏è A02:2021 - Cryptographic Failures (HTTPS, Identity PasswordHasher - not BCrypt)
‚úÖ A03:2021 - Injection (Parameterized queries, validation)
‚úÖ A05:2021 - Security Misconfiguration (Secure defaults, HTTPS)
‚úÖ A07:2021 - XSS (Output encoding, input validation)

IMPLEMENTATION NOTES:
- Password hashing uses ASP.NET Core Identity PasswordHasher (PBKDF2), not BCrypt
- JWT secret should be moved to Key Vault in production
- Resource-level authorization not fully implemented
- Rate limiting not implemented (could use YARP Gateway)

I need a UML State Diagram showing the complete lifecycle of a booking in the BookMyHome campsite booking system.

CRITICAL BUSINESS RULE: Payment is handled separately via Payment entity. Booking.Confirm() method ONLY checks if AccommodationSpotId is assigned, it does NOT check payment status. Payment state is independent of booking state.

Please create a state diagram with the following states and transitions:

STATES (use rounded rectangles):

1. [Initial State]
   Symbol: Solid black circle (●)
   Description: Starting point

2. Pending
   Color: Yellow
   Description: Booking created, awaiting accommodation spot assignment
   Entry action: Raise BookingCreatedEvent
   Do activity: Reserve accommodation type
   Exit action: None
   Note: Payment is handled separately, not part of booking state

3. Confirmed
   Color: Green
   Description: Accommodation spot assigned, booking confirmed
   Entry action: Raise BookingConfirmedEvent
   Do activity: Block accommodation spot in calendar
   Exit action: None
   Note: Confirm() only checks AccommodationSpotId, not payment

4. Cancelled
   Color: Red
   Description: Booking cancelled by user or admin
   Entry action: Raise BookingCancelledEvent
   Do activity: Release accommodation spot
   Exit action: None
   Note: Payment refund handled separately

5. Completed
   Color: Blue
   Description: Guest checked out, booking finished
   Entry action: None
   Do activity: Mark booking as completed
   Exit action: None
   Note: No domain event raised for Complete()

6. [Final State]
   Symbol: Solid black circle with outer ring (◉)
   Description: End point

TRANSITIONS (use arrows with labels):

1. [Initial] → Pending
   Trigger: Create booking
   Guard: None
   Action: booking.Create()
   Note: Raises BookingCreatedEvent
   
2. Pending → Confirmed
   Trigger: Confirm()
   Guard: [AccommodationSpotId != null]
   Action: booking.Confirm()
   Note: Only checks AccommodationSpotId, NOT payment status
   Note: Raises BookingConfirmedEvent
   
3. Pending → Cancelled
   Trigger: Cancel()
   Guard: [user requests cancellation OR admin cancels]
   Action: booking.Cancel()
   Note: Raises BookingCancelledEvent
   
4. Confirmed → Cancelled
   Trigger: Cancel()
   Guard: None
   Action: booking.Cancel()
   Note: Raises BookingCancelledEvent
   Note: Payment refund handled separately (Payment entity)
   
5. Confirmed → Completed
   Trigger: Complete()
   Guard: [currentDate >= checkOutDate OR manually triggered]
   Action: booking.Complete()
   Note: No domain event raised
   
6. Cancelled → [Final]
   Trigger: Archive (implicit)
   Guard: None
   Action: None
   Note: Cancelled bookings remain in database
   
7. Completed → [Final]
   Trigger: Archive (implicit)
   Guard: None
   Action: None
   Note: Completed bookings remain in database

SELF-TRANSITIONS (loops back to same state):

1. Pending → Pending
   Trigger: UpdateSpecialRequests()
   Guard: [booking.Status == Pending]
   Action: booking.UpdateSpecialRequests()
   Note: Can update special requests while pending

2. Confirmed → Confirmed
   Trigger: UpdateSpecialRequests()
   Guard: [booking.Status == Confirmed]
   Action: booking.UpdateSpecialRequests()
   Note: Can update special requests while confirmed

3. Pending → Pending
   Trigger: AssignAccommodationSpot()
   Guard: [booking.Status == Pending AND AccommodationSpotId == null]
   Action: booking.AssignAccommodationSpot(spotId)
   Note: Assigns spot but doesn't change state (must call Confirm())

GUARDS (conditions in square brackets):

[AccommodationSpotId != null]
- Accommodation spot has been assigned to booking
- This is the ONLY guard for Confirm() transition
- Payment status is NOT checked

[user requests cancellation OR admin cancels]
- User clicked "Cancel Booking" button
- OR Admin cancelled the booking via admin panel

[currentDate >= checkOutDate OR manually triggered]
- Current date is on or after check-out date
- OR Admin manually marks booking as completed

ACTIONS (what happens during transition):

booking.Create()
- Validate dates (check-in < check-out)
- Check accommodation type availability
- Calculate total price
- Assign booking ID
- Set status to Pending
- Raise BookingCreatedEvent

booking.Confirm()
- Guard: AccommodationSpotId must be assigned
- Update status to Confirmed
- Raise BookingConfirmedEvent
- Note: Does NOT check payment status

booking.Cancel()
- Update status to Cancelled
- Set CancellationDate
- Release accommodation spot (if assigned)
- Raise BookingCancelledEvent
- Note: Payment refund handled separately

booking.Complete()
- Update status to Completed
- Note: No domain event raised
- Note: Called manually or automatically after check-out

ENTRY/EXIT ACTIONS:

State: Pending
- Entry: Raise BookingCreatedEvent
- Exit: None

State: Confirmed
- Entry: Raise BookingConfirmedEvent
- Exit: None

State: Cancelled
- Entry: Raise BookingCancelledEvent, Set CancellationDate
- Exit: Release Accommodation Spot (if assigned)

State: Completed
- Entry: None (no domain event)
- Exit: None

VISUAL STYLE:

- Use rounded rectangles for states
- Use solid arrows for transitions
- Label transitions with: trigger [guard] / action
- Use different colors for different states:
  * Yellow: Pending
  * Green: Confirmed
  * Red: Cancelled
  * Blue: Completed
- Show entry/exit actions inside state boxes
- Use notes to explain important guards or actions
- Mark payment-related notes clearly

NOTES TO ADD:

Note near Pending → Confirmed:
"Confirm() transition ONLY checks AccommodationSpotId != null.
Payment is handled separately via Payment entity.
Payment status does NOT affect booking state transition."

Note near Confirmed:
"Booking is confirmed when accommodation spot is assigned.
Payment may be pending, completed, or failed - this is separate."

Note near Cancelled:
"Payment refund is handled separately via Payment.ProcessRefund().
Booking cancellation does NOT automatically process refund."

Note near Payment (separate entity):
"Payment entity has its own state machine:
- Pending → Completed (payment successful)
- Pending → Failed (payment failed)
- Completed → Refunded (refund processed)
Payment state is independent of booking state."

LEGEND:
- ● = Initial state
- ◉ = Final state
- Rounded rectangle = State
- Arrow = Transition
- [condition] = Guard
- action() = Action
- entry: = Entry action
- exit: = Exit action
- Note = Important clarification

IMPORTANT CLARIFICATIONS:
- Payment is NOT part of booking state machine
- Confirm() only checks AccommodationSpotId, NOT payment
- Payment has separate state machine (PaymentStatus)
- BookingCreatedEvent, BookingConfirmedEvent, BookingCancelledEvent are raised
- BookingCompletedEvent does NOT exist (Complete() doesn't raise event)

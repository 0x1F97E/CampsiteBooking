@page "/admin/pricing"
@rendermode InteractiveServer
@inject IDialogService DialogService
@inject ISnackbar Snackbar

<PageTitle>Pricing Management - Campsite Booking</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraExtraLarge" Class="mt-4">
    <MudText Typo="Typo.h3" GutterBottom="true">
        <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Class="mr-2" />
        Pricing Management
    </MudText>
    <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-6">
        Configure campsite-specific pricing - each campsite has its own base prices and seasonal rates
    </MudText>

    <MudGrid>
        <!-- Campsite Selector -->
        <MudItem xs="12">
            <MudPaper Elevation="3" Class="pa-4">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSelect T="int"
                                  @bind-Value="_selectedCampsiteId"
                                  Label="Select Campsite"
                                  Variant="Variant.Outlined"
                                  AdornmentIcon="@Icons.Material.Filled.Cabin"
                                  AdornmentColor="Color.Primary">
                            @foreach (var campsite in _campsites)
                            {
                                <MudSelectItem T="int" Value="@campsite.Id">
                                    @campsite.Name (@campsite.Region)
                                </MudSelectItem>
                            }
                        </MudSelect>
                    </MudItem>
                    <MudItem xs="12" md="6">
                        <MudAlert Severity="Severity.Info" Dense="true">
                            <strong>@GetSelectedCampsiteName()</strong> -
                            Attractiveness: <MudChip T="string" Size="Size.Small" Color="@GetAttractivenessColor()">@GetSelectedCampsite()?.Attractiveness</MudChip>
                        </MudAlert>
                    </MudItem>
                </MudGrid>
            </MudPaper>
        </MudItem>

        <!-- Accommodation Types & Pricing -->
        <MudItem xs="12" md="6">
            <MudText Typo="Typo.h6" Class="mb-3">
                <MudIcon Icon="@Icons.Material.Filled.Bed" Class="mr-2" />
                Accommodation Types & Pricing
            </MudText>
            <MudText Typo="Typo.caption" Color="Color.Secondary" Class="mb-4">
                Manage accommodation types, quantities, prices, and their peripheral purchases for @GetSelectedCampsiteName()
            </MudText>

            @foreach (var accommodation in GetSelectedCampsitePricing())
            {
                <MudCard Elevation="2" Class="mb-3">
                    <MudCardHeader>
                        <CardHeaderContent>
                            <div class="d-flex align-center justify-space-between">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@GetAccommodationIcon(accommodation.Type)" Class="mr-3" Color="Color.Primary" Size="Size.Large" />
                                    <div>
                                        <MudText Typo="Typo.h6">@accommodation.Type</MudText>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                                            @accommodation.AvailableUnits units • $@accommodation.Price.ToString("N2")/night • @accommodation.MaxGuests guests max
                                        </MudText>
                                    </div>
                                </div>
                                <div>
                                    <MudChip T="string" Size="Size.Small" Color="@(accommodation.IsActive ? Color.Success : Color.Default)">
                                        @(accommodation.IsActive ? "Active" : "Inactive")
                                    </MudChip>
                                </div>
                            </div>
                        </CardHeaderContent>
                        <CardHeaderActions>
                            <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                          Color="Color.Primary"
                                          Size="Size.Small"
                                          OnClick="@(() => EditAccommodationType(accommodation))" />
                            <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                          Color="Color.Error"
                                          Size="Size.Small"
                                          OnClick="@(() => DeleteAccommodationType(accommodation))" />
                        </CardHeaderActions>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudText Typo="Typo.subtitle2" Class="mb-2">
                            <MudIcon Icon="@Icons.Material.Filled.ShoppingCart" Size="Size.Small" Class="mr-1" />
                            Accommodation Peripheral Purchases
                        </MudText>
                        <MudDivider Class="mb-3" />

                        @if (accommodation.AccommodationPeripheralPurchases != null && accommodation.AccommodationPeripheralPurchases.Any())
                        {
                            <MudTable Items="@accommodation.AccommodationPeripheralPurchases" Hover="true" Dense="true" Elevation="0" Class="mb-2">
                                <HeaderContent>
                                    <MudTh>Service</MudTh>
                                    <MudTh>Price</MudTh>
                                    <MudTh>Status</MudTh>
                                    <MudTh>Actions</MudTh>
                                </HeaderContent>
                                <RowTemplate>
                                    <MudTd DataLabel="Service">
                                        <div class="d-flex align-center">
                                            <MudIcon Icon="@GetPeripheralPurchaseIcon(context.Name)" Size="Size.Small" Class="mr-2" Color="Color.Primary" />
                                            <div>
                                                <MudText Typo="Typo.body2"><strong>@context.Name</strong></MudText>
                                                <MudText Typo="Typo.caption" Color="Color.Secondary">@context.Description</MudText>
                                            </div>
                                        </div>
                                    </MudTd>
                                    <MudTd DataLabel="Price">
                                        <MudText Typo="Typo.body2" Color="Color.Success">
                                            <strong>$@context.Price.ToString("N2")</strong>
                                        </MudText>
                                    </MudTd>
                                    <MudTd DataLabel="Status">
                                        <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                            @(context.IsActive ? "Active" : "Inactive")
                                        </MudChip>
                                    </MudTd>
                                    <MudTd DataLabel="Actions">
                                        <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                                      Color="Color.Primary"
                                                      Size="Size.Small"
                                                      OnClick="@(() => EditAccommodationPeripheralPurchase(accommodation, context))" />
                                        <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                                      Color="Color.Error"
                                                      Size="Size.Small"
                                                      OnClick="@(() => DeleteAccommodationPeripheralPurchase(accommodation, context))" />
                                    </MudTd>
                                </RowTemplate>
                            </MudTable>
                        }
                        else
                        {
                            <MudAlert Severity="Severity.Info" Dense="true" Class="mb-2">
                                No peripheral purchases configured for this accommodation type.
                            </MudAlert>
                        }

                        <MudButton Variant="Variant.Outlined"
                                   Color="Color.Primary"
                                   Size="Size.Small"
                                   StartIcon="@Icons.Material.Filled.Add"
                                   OnClick="@(() => AddAccommodationPeripheralPurchase(accommodation))">
                            Add Purchase
                        </MudButton>
                    </MudCardContent>
                </MudCard>
            }
        </MudItem>

        <!-- Campsite Peripheral Purchases -->
        <MudItem xs="12" md="6">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Campsite Peripheral Purchases</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Manage activities and services for @GetSelectedCampsiteName()
                        </MudText>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Small" StartIcon="@Icons.Material.Filled.Add" OnClick="AddPeripheralPurchase">
                            Add Purchase
                        </MudButton>
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                    <MudTable Items="@GetSelectedCampsitePeripheralPurchases()" Hover="true" Dense="true" Elevation="0">
                        <HeaderContent>
                            <MudTh>Activity/Service</MudTh>
                            <MudTh>Price</MudTh>
                            <MudTh>Status</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Activity/Service">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@GetPeripheralPurchaseIcon(context.Name)" Class="mr-3" Color="Color.Primary" />
                                    <div>
                                        <MudText><strong>@context.Name</strong></MudText>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">@context.Description</MudText>
                                    </div>
                                </div>
                            </MudTd>
                            <MudTd DataLabel="Price">
                                <MudText Typo="Typo.body1" Color="Color.Success">
                                    <strong>$@context.Price.ToString("N2")</strong>
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="Status">
                                <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                    @(context.IsActive ? "Active" : "Inactive")
                                </MudChip>
                            </MudTd>
                            <MudTd DataLabel="Actions">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                              Color="Color.Primary"
                                              Size="Size.Small"
                                              OnClick="@(() => EditPeripheralPurchase(context))" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete"
                                              Color="Color.Error"
                                              Size="Size.Small"
                                              OnClick="@(() => DeletePeripheralPurchase(context))" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Seasonal Multipliers -->
        <MudItem xs="12" md="6">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Seasonal Multipliers</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Applies to all campsites
                        </MudText>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        <MudIconButton Icon="@Icons.Material.Filled.Edit"
                                      Color="Color.Primary"
                                      OnClick="EditSeasonalPricing" />
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                    <MudList T="string" Dense="true">
                        @foreach (var season in _seasonalMultipliers)
                        {
                            <MudListItem T="string">
                                <div class="d-flex justify-space-between align-center" style="width: 100%;">
                                    <div>
                                        <MudText><strong>@season.Name</strong></MudText>
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">@season.DateRange</MudText>
                                    </div>
                                    <MudChip T="string" Color="@GetSeasonColor(season.Name)">
                                        @season.Multiplier.ToString("P0")
                                    </MudChip>
                                </div>
                            </MudListItem>
                            <MudDivider />
                        }
                    </MudList>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Accommodation Summary Statistics -->
        <MudItem xs="12" md="6">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Accommodation Summary</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Overview for @GetSelectedCampsiteName()
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="6">
                            <MudPaper Elevation="0" Class="pa-3 text-center" Style="background-color: #f5f5f5;">
                                <MudText Typo="Typo.h4" Color="Color.Primary">@GetTotalUnits()</MudText>
                                <MudText Typo="Typo.caption">Total Units</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="6">
                            <MudPaper Elevation="0" Class="pa-3 text-center" Style="background-color: #f5f5f5;">
                                <MudText Typo="Typo.h4" Color="Color.Success">@GetTotalCapacity()</MudText>
                                <MudText Typo="Typo.caption">Total Guest Capacity</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="6">
                            <MudPaper Elevation="0" Class="pa-3 text-center" Style="background-color: #f5f5f5;">
                                <MudText Typo="Typo.h4" Color="Color.Info">@GetAccommodationTypeCount()</MudText>
                                <MudText Typo="Typo.caption">Accommodation Types</MudText>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="6">
                            <MudPaper Elevation="0" Class="pa-3 text-center" Style="background-color: #f5f5f5;">
                                <MudText Typo="Typo.h4" Color="Color.Warning">$@GetAveragePrice().ToString("N0")</MudText>
                                <MudText Typo="Typo.caption">Avg. Price/Night</MudText>
                            </MudPaper>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Campsite Comparison Table -->
        <MudItem xs="12">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Campsite Pricing Comparison</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Compare base prices across all campsites - more attractive campsites have higher prices
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudTable Items="@_campsites" Hover="true" Dense="true" Elevation="0">
                        <HeaderContent>
                            <MudTh>Campsite</MudTh>
                            <MudTh>Region</MudTh>
                            <MudTh>Attractiveness</MudTh>
                            <MudTh>Cabin</MudTh>
                            <MudTh>Tent Site</MudTh>
                            <MudTh>Glamping</MudTh>
                            <MudTh>RV Spot</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Campsite">
                                <MudText Typo="Typo.body2"><strong>@context.Name</strong></MudText>
                            </MudTd>
                            <MudTd DataLabel="Region">
                                <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">@context.Region</MudChip>
                            </MudTd>
                            <MudTd DataLabel="Attractiveness">
                                <MudChip T="string" Size="Size.Small" Color="@GetAttractivenessColor(context.Attractiveness)">
                                    @context.Attractiveness
                                </MudChip>
                            </MudTd>
                            <MudTd DataLabel="Cabin">
                                <MudText Typo="Typo.body2" Color="Color.Success">
                                    $@context.Pricing.FirstOrDefault(p => p.Type == "Cabin")?.Price.ToString("N2")
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="Tent Site">
                                <MudText Typo="Typo.body2" Color="Color.Success">
                                    $@context.Pricing.FirstOrDefault(p => p.Type == "Tent Site")?.Price.ToString("N2")
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="Glamping">
                                <MudText Typo="Typo.body2" Color="Color.Success">
                                    $@context.Pricing.FirstOrDefault(p => p.Type == "Glamping")?.Price.ToString("N2")
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="RV Spot">
                                <MudText Typo="Typo.body2" Color="Color.Success">
                                    $@context.Pricing.FirstOrDefault(p => p.Type == "RV Spot")?.Price.ToString("N2")
                                </MudText>
                            </MudTd>
                            <MudTd DataLabel="Actions">
                                <MudButton Size="Size.Small"
                                          Variant="Variant.Outlined"
                                          Color="Color.Primary"
                                          OnClick="@(() => SelectCampsite(context.Id))">
                                    Edit Pricing
                                </MudButton>
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Active Discounts -->
        <MudItem xs="12">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Active Discounts & Promotions</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Discount codes apply to all campsites
                        </MudText>
                    </CardHeaderContent>
                    <CardHeaderActions>
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" OnClick="AddDiscount">
                            Add Discount
                        </MudButton>
                    </CardHeaderActions>
                </MudCardHeader>
                <MudCardContent>
                    <MudTable Items="@_discounts" Hover="true" Dense="true" Elevation="0">
                        <HeaderContent>
                            <MudTh>Code</MudTh>
                            <MudTh>Description</MudTh>
                            <MudTh>Type</MudTh>
                            <MudTh>Value</MudTh>
                            <MudTh>Valid From</MudTh>
                            <MudTh>Valid Until</MudTh>
                            <MudTh>Uses</MudTh>
                            <MudTh>Status</MudTh>
                            <MudTh>Actions</MudTh>
                        </HeaderContent>
                        <RowTemplate>
                            <MudTd DataLabel="Code">
                                <MudText Typo="Typo.body2"><strong>@context.Code</strong></MudText>
                            </MudTd>
                            <MudTd DataLabel="Description">@context.Description</MudTd>
                            <MudTd DataLabel="Type">
                                <MudChip T="string" Size="Size.Small" Variant="Variant.Outlined">@context.Type</MudChip>
                            </MudTd>
                            <MudTd DataLabel="Value">
                                @if (context.Type == "Percentage")
                                {
                                    <MudText>@context.Value%</MudText>
                                }
                                else
                                {
                                    <MudText>$@context.Value</MudText>
                                }
                            </MudTd>
                            <MudTd DataLabel="Valid From">@context.ValidFrom.ToString("MMM dd, yyyy")</MudTd>
                            <MudTd DataLabel="Valid Until">@context.ValidUntil.ToString("MMM dd, yyyy")</MudTd>
                            <MudTd DataLabel="Uses">@context.UsedCount / @(context.MaxUses == 0 ? "∞" : context.MaxUses.ToString())</MudTd>
                            <MudTd DataLabel="Status">
                                <MudChip T="string" Size="Size.Small" Color="@(context.IsActive ? Color.Success : Color.Default)">
                                    @(context.IsActive ? "Active" : "Inactive")
                                </MudChip>
                            </MudTd>
                            <MudTd DataLabel="Actions">
                                <MudIconButton Icon="@Icons.Material.Filled.Edit" Color="Color.Primary" Size="Size.Small" OnClick="@(() => EditDiscount(context))" />
                                <MudIconButton Icon="@Icons.Material.Filled.Delete" Color="Color.Error" Size="Size.Small" OnClick="@(() => DeleteDiscount(context))" />
                            </MudTd>
                        </RowTemplate>
                    </MudTable>
                </MudCardContent>
            </MudCard>
        </MudItem>

        <!-- Pricing Calculator Preview -->
        <MudItem xs="12">
            <MudCard Elevation="3">
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Pricing Calculator Preview</MudText>
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Calculate estimated price for @GetSelectedCampsiteName()
                        </MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    <MudGrid>
                        <MudItem xs="12" md="3">
                            <MudSelect T="string" @bind-Value="_previewAccommodationType" Label="Accommodation Type" Variant="Variant.Outlined">
                                <MudSelectItem T="string" Value="@("Cabin")">Cabin</MudSelectItem>
                                <MudSelectItem T="string" Value="@("Tent Site")">Tent Site</MudSelectItem>
                                <MudSelectItem T="string" Value="@("Glamping")">Glamping</MudSelectItem>
                                <MudSelectItem T="string" Value="@("RV Spot")">RV Spot</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="3">
                            <MudSelect T="string" @bind-Value="_previewSeason" Label="Season" Variant="Variant.Outlined">
                                <MudSelectItem T="string" Value="@("High Season")">High Season</MudSelectItem>
                                <MudSelectItem T="string" Value="@("Medium Season")">Medium Season</MudSelectItem>
                                <MudSelectItem T="string" Value="@("Low Season")">Low Season</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="3">
                            <MudNumericField @bind-Value="_previewNights" Label="Number of Nights" Variant="Variant.Outlined" Min="1" />
                        </MudItem>
                        <MudItem xs="12" md="3">
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" FullWidth="true" OnClick="CalculatePreview">
                                Calculate
                            </MudButton>
                        </MudItem>
                        <MudItem xs="12">
                            <MudAlert Severity="Severity.Info" Dense="true">
                                <MudText Typo="Typo.body1">
                                    <strong>Estimated Total:</strong> $@_previewTotal.ToString("N2")
                                </MudText>
                                <MudText Typo="Typo.caption">
                                    Base: $@_previewBase.ToString("N2") × @_previewMultiplier.ToString("P0") × @_previewNights nights
                                </MudText>
                            </MudAlert>
                        </MudItem>
                    </MudGrid>
                </MudCardContent>
            </MudCard>
        </MudItem>
    </MudGrid>
</MudContainer>

@code {
    private int _selectedCampsiteId = 1;
    private List<CampsitePricingDto> _campsites = new();
    private List<SeasonalMultiplierDto> _seasonalMultipliers = new();
    private List<DiscountDto> _discounts = new();

    // Preview calculator
    private string _previewAccommodationType = "Cabin";
    private string _previewSeason = "High Season";
    private int _previewNights = 3;
    private decimal _previewBase = 0;
    private decimal _previewMultiplier = 1.5m;
    private decimal _previewTotal = 0;

    protected override void OnInitialized()
    {
        LoadPricingData();
        CalculatePreview();
    }

    private void LoadPricingData()
    {
        // Load campsites with their specific pricing based on attractiveness
        _campsites = new List<CampsitePricingDto>
        {
            new()
            {
                Id = 1,
                Name = "Copenhagen Beach Camp",
                Region = "Zealand",
                Attractiveness = "Very High",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 1, Type = "Cabin", Price = 150, AvailableUnits = 12, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 101, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 50.00m, IsActive = true },
                            new() { Id = 102, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 25.00m, IsActive = true },
                            new() { Id = 103, Name = "Firewood Bundle", Description = "Bundle of firewood for fireplace", Price = 15.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 2, Type = "Tent Site", Price = 60, AvailableUnits = 25, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 104, Name = "Tent Rental", Description = "4-person tent rental", Price = 30.00m, IsActive = true },
                            new() { Id = 105, Name = "Sleeping Bag Rental", Description = "Warm sleeping bag rental", Price = 15.00m, IsActive = true },
                            new() { Id = 106, Name = "Camping Chair Set", Description = "Set of 4 camping chairs", Price = 10.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 3, Type = "Glamping", Price = 220, AvailableUnits = 8, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 107, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 75.00m, IsActive = true },
                            new() { Id = 108, Name = "Welcome Package", Description = "Champagne and snacks", Price = 40.00m, IsActive = true },
                            new() { Id = 109, Name = "Private Chef", Description = "Personal chef for one meal", Price = 150.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 4, Type = "RV Spot", Price = 100, AvailableUnits = 15, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 110, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 20.00m, IsActive = true },
                            new() { Id = 111, Name = "Water Hookup", Description = "Fresh water connection", Price = 15.00m, IsActive = true },
                            new() { Id = 112, Name = "Sewage Disposal", Description = "Sewage disposal service", Price = 25.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 1, Name = "Fishing Trip", Description = "Guided fishing tour on the beach", Price = 75.00m, IsActive = true },
                    new() { Id = 2, Name = "Morning Yoga", Description = "Sunrise yoga session on the beach", Price = 25.00m, IsActive = true },
                    new() { Id = 3, Name = "Restaurant Brunch (Daily)", Description = "Daily brunch buffet at campsite restaurant", Price = 35.00m, IsActive = true },
                    new() { Id = 4, Name = "Kayak Rental", Description = "Full day kayak rental", Price = 45.00m, IsActive = true },
                    new() { Id = 5, Name = "Beach Volleyball", Description = "Beach volleyball court reservation (2 hours)", Price = 15.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 2,
                Name = "Skagen North Point",
                Region = "North Jutland",
                Attractiveness = "Very High",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 5, Type = "Cabin", Price = 145, AvailableUnits = 10, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 201, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 50.00m, IsActive = true },
                            new() { Id = 202, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 25.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 6, Type = "Tent Site", Price = 55, AvailableUnits = 30, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 203, Name = "Tent Rental", Description = "4-person tent rental", Price = 30.00m, IsActive = true },
                            new() { Id = 204, Name = "Sleeping Bag Rental", Description = "Warm sleeping bag rental", Price = 15.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 7, Type = "Glamping", Price = 210, AvailableUnits = 6, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 205, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 75.00m, IsActive = true },
                            new() { Id = 206, Name = "Welcome Package", Description = "Champagne and snacks", Price = 40.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 8, Type = "RV Spot", Price = 95, AvailableUnits = 12, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 207, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 20.00m, IsActive = true },
                            new() { Id = 208, Name = "Water Hookup", Description = "Fresh water connection", Price = 15.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 6, Name = "Lighthouse Tour", Description = "Guided tour of Skagen lighthouse", Price = 40.00m, IsActive = true },
                    new() { Id = 7, Name = "Morning Yoga", Description = "Beach yoga at sunrise", Price = 25.00m, IsActive = true },
                    new() { Id = 8, Name = "Restaurant Brunch (Daily)", Description = "Scandinavian brunch buffet", Price = 38.00m, IsActive = true },
                    new() { Id = 9, Name = "Bike Rental", Description = "Full day bike rental", Price = 30.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 3,
                Name = "Aarhus Forest Retreat",
                Region = "Central Jutland",
                Attractiveness = "High",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 9, Type = "Cabin", Price = 120, AvailableUnits = 15, MaxGuests = 5, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 301, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 45.00m, IsActive = true },
                            new() { Id = 302, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 20.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 10, Type = "Tent Site", Price = 45, AvailableUnits = 40, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 303, Name = "Tent Rental", Description = "4-person tent rental", Price = 25.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 11, Type = "Glamping", Price = 180, AvailableUnits = 10, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 304, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 70.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 12, Type = "RV Spot", Price = 85, AvailableUnits = 20, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 305, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 18.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 10, Name = "Forest Hiking Tour", Description = "Guided nature walk through the forest", Price = 35.00m, IsActive = true },
                    new() { Id = 11, Name = "Morning Yoga", Description = "Forest yoga and meditation", Price = 25.00m, IsActive = true },
                    new() { Id = 12, Name = "Restaurant Brunch (Daily)", Description = "Organic brunch buffet", Price = 32.00m, IsActive = true },
                    new() { Id = 13, Name = "Mountain Bike Rental", Description = "Full day mountain bike rental", Price = 40.00m, IsActive = true },
                    new() { Id = 14, Name = "Campfire Package", Description = "Firewood and s'mores kit", Price = 20.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 4,
                Name = "Odense Family Camp",
                Region = "Funen",
                Attractiveness = "Medium",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 13, Type = "Cabin", Price = 100, AvailableUnits = 18, MaxGuests = 5, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 401, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 40.00m, IsActive = true },
                            new() { Id = 402, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 20.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 14, Type = "Tent Site", Price = 40, AvailableUnits = 50, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 403, Name = "Tent Rental", Description = "4-person tent rental", Price = 25.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 15, Type = "RV Spot", Price = 70, AvailableUnits = 25, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 404, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 15.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 15, Name = "Family Fishing Trip", Description = "Family-friendly fishing experience", Price = 60.00m, IsActive = true },
                    new() { Id = 16, Name = "Morning Yoga", Description = "Family yoga session", Price = 20.00m, IsActive = true },
                    new() { Id = 17, Name = "Restaurant Brunch (Daily)", Description = "Family brunch buffet", Price = 30.00m, IsActive = true },
                    new() { Id = 18, Name = "Playground Access", Description = "Premium playground area access", Price = 10.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 5,
                Name = "Bornholm Island Camp",
                Region = "Bornholm",
                Attractiveness = "Very High",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 16, Type = "Cabin", Price = 140, AvailableUnits = 8, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 501, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 50.00m, IsActive = true },
                            new() { Id = 502, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 25.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 17, Type = "Tent Site", Price = 55, AvailableUnits = 20, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 503, Name = "Tent Rental", Description = "4-person tent rental", Price = 30.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 18, Type = "Glamping", Price = 200, AvailableUnits = 5, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 504, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 75.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 19, Type = "RV Spot", Price = 90, AvailableUnits = 10, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 505, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 20.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 19, Name = "Island Boat Tour", Description = "Scenic boat tour around Bornholm", Price = 85.00m, IsActive = true },
                    new() { Id = 20, Name = "Morning Yoga", Description = "Cliffside yoga session", Price = 28.00m, IsActive = true },
                    new() { Id = 21, Name = "Restaurant Brunch (Daily)", Description = "Island cuisine brunch", Price = 40.00m, IsActive = true },
                    new() { Id = 22, Name = "Rock Climbing", Description = "Guided rock climbing experience", Price = 65.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 6,
                Name = "Ribe Viking Camp",
                Region = "South Jutland",
                Attractiveness = "Medium",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 20, Type = "Cabin", Price = 95, AvailableUnits = 12, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 601, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 40.00m, IsActive = true },
                            new() { Id = 602, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 20.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 21, Type = "Tent Site", Price = 35, AvailableUnits = 35, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 603, Name = "Tent Rental", Description = "4-person tent rental", Price = 20.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 22, Type = "Glamping", Price = 140, AvailableUnits = 4, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 604, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 65.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 23, Type = "RV Spot", Price = 65, AvailableUnits = 18, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 605, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 15.00m, IsActive = true }
                        }
                    }
                },
                PeripheralPurchases = new List<PeripheralPurchaseDto>
                {
                    new() { Id = 23, Name = "Viking Experience Tour", Description = "Historical Viking village tour", Price = 50.00m, IsActive = true },
                    new() { Id = 24, Name = "Morning Yoga", Description = "Viking-themed yoga session", Price = 22.00m, IsActive = true },
                    new() { Id = 25, Name = "Restaurant Brunch (Daily)", Description = "Traditional Danish brunch", Price = 28.00m, IsActive = true },
                    new() { Id = 26, Name = "Archery Lesson", Description = "Viking archery experience", Price = 35.00m, IsActive = true }
                }
            },
            new()
            {
                Id = 7,
                Name = "Roskilde Lake Camp",
                Region = "Zealand",
                Attractiveness = "High",
                Pricing = new List<BasePricingDto>
                {
                    new() {
                        Id = 24, Type = "Cabin", Price = 125, AvailableUnits = 14, MaxGuests = 5, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 701, Name = "Cabin Cleaning", Description = "Professional cleaning service", Price = 45.00m, IsActive = true },
                            new() { Id = 702, Name = "Linen Package", Description = "Fresh bed linens and towels", Price = 22.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 25, Type = "Tent Site", Price = 50, AvailableUnits = 28, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 703, Name = "Tent Rental", Description = "4-person tent rental", Price = 28.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 26, Type = "Glamping", Price = 185, AvailableUnits = 7, MaxGuests = 4, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 704, Name = "Premium Cleaning", Description = "Luxury cleaning service", Price = 70.00m, IsActive = true }
                        }
                    },
                    new() {
                        Id = 27, Type = "RV Spot", Price = 80, AvailableUnits = 16, MaxGuests = 6, IsActive = true,
                        AccommodationPeripheralPurchases = new List<PeripheralPurchaseDto>
                        {
                            new() { Id = 705, Name = "Electricity Hookup", Description = "30-amp electrical connection", Price = 18.00m, IsActive = true }
                        }
                    }
                }
            },
            new()
            {
                Id = 8,
                Name = "Aalborg Fjord Camp",
                Region = "North Jutland",
                Attractiveness = "Medium",
                Pricing = new List<BasePricingDto>
                {
                    new() { Id = 28, Type = "Cabin", Price = 105, AvailableUnits = 16, MaxGuests = 5, IsActive = true },
                    new() { Id = 29, Type = "Tent Site", Price = 42, AvailableUnits = 32, MaxGuests = 4, IsActive = true },
                    new() { Id = 30, Type = "Glamping", Price = 160, AvailableUnits = 6, MaxGuests = 4, IsActive = true },
                    new() { Id = 31, Type = "RV Spot", Price = 75, AvailableUnits = 14, MaxGuests = 6, IsActive = true }
                }
            }
        };

        _seasonalMultipliers = new List<SeasonalMultiplierDto>
        {
            new() { Name = "High Season", DateRange = "Jun 1 - Aug 31", Multiplier = 1.5m },
            new() { Name = "Medium Season", DateRange = "Apr 1 - May 31, Sep 1 - Oct 31", Multiplier = 1.2m },
            new() { Name = "Low Season", DateRange = "Nov 1 - Mar 31", Multiplier = 0.8m }
        };

        _discounts = new List<DiscountDto>
        {
            new() { Code = "SUMMER2024", Description = "Summer Special Discount", Type = "Percentage", Value = 15, ValidFrom = DateTime.Now.AddDays(-30), ValidUntil = DateTime.Now.AddDays(60), UsedCount = 45, MaxUses = 100, IsActive = true },
            new() { Code = "EARLYBIRD", Description = "Early Bird Booking", Type = "Percentage", Value = 10, ValidFrom = DateTime.Now.AddDays(-60), ValidUntil = DateTime.Now.AddDays(90), UsedCount = 23, MaxUses = 0, IsActive = true },
            new() { Code = "FAMILY50", Description = "Family Package Discount", Type = "Fixed", Value = 50, ValidFrom = DateTime.Now.AddDays(-15), ValidUntil = DateTime.Now.AddDays(45), UsedCount = 12, MaxUses = 50, IsActive = true },
            new() { Code = "WINTER2023", Description = "Winter Promotion", Type = "Percentage", Value = 20, ValidFrom = DateTime.Now.AddDays(-120), ValidUntil = DateTime.Now.AddDays(-30), UsedCount = 67, MaxUses = 100, IsActive = false }
        };
    }

    private CampsitePricingDto? GetSelectedCampsite()
    {
        return _campsites.FirstOrDefault(c => c.Id == _selectedCampsiteId);
    }

    private string GetSelectedCampsiteName()
    {
        return GetSelectedCampsite()?.Name ?? "Unknown";
    }

    private List<BasePricingDto> GetSelectedCampsitePricing()
    {
        return GetSelectedCampsite()?.Pricing ?? new List<BasePricingDto>();
    }

    private void SelectCampsite(int campsiteId)
    {
        _selectedCampsiteId = campsiteId;
        CalculatePreview();
    }

    private void CalculatePreview()
    {
        var selectedCampsite = GetSelectedCampsite();
        var basePrice = selectedCampsite?.Pricing.FirstOrDefault(p => p.Type == _previewAccommodationType)?.Price ?? 0;
        var multiplier = _seasonalMultipliers.FirstOrDefault(s => s.Name == _previewSeason)?.Multiplier ?? 1.0m;

        _previewBase = basePrice;
        _previewMultiplier = multiplier;
        _previewTotal = basePrice * multiplier * _previewNights;
    }

    private string GetAccommodationIcon(string type) => type switch
    {
        "Cabin" => Icons.Material.Filled.Cabin,
        "Tent Site" => Icons.Material.Filled.Landscape,
        "Glamping" => Icons.Material.Filled.NightShelter,
        "RV Spot" => Icons.Material.Filled.RvHookup,
        _ => Icons.Material.Filled.Home
    };

    private Color GetSeasonColor(string season) => season switch
    {
        "High Season" => Color.Error,
        "Medium Season" => Color.Warning,
        "Low Season" => Color.Info,
        _ => Color.Default
    };

    private Color GetAttractivenessColor(string? attractiveness = null)
    {
        var attr = attractiveness ?? GetSelectedCampsite()?.Attractiveness ?? "";
        return attr switch
        {
            "Very High" => Color.Error,
            "High" => Color.Warning,
            "Medium" => Color.Info,
            _ => Color.Default
        };
    }

    private int GetTotalUnits()
    {
        return GetSelectedCampsitePricing().Sum(p => p.AvailableUnits);
    }

    private int GetTotalCapacity()
    {
        return GetSelectedCampsitePricing().Sum(p => p.AvailableUnits * p.MaxGuests);
    }

    private int GetAccommodationTypeCount()
    {
        return GetSelectedCampsitePricing().Count;
    }

    private decimal GetAveragePrice()
    {
        var pricing = GetSelectedCampsitePricing();
        return pricing.Any() ? pricing.Average(p => p.Price) : 0;
    }

    private async Task AddAccommodationType()
    {
        var newAccommodation = new BasePricingDto();
        var parameters = new DialogParameters();
        parameters.Add("CampsiteName", GetSelectedCampsiteName());
        parameters.Add("AccommodationType", newAccommodation);
        parameters.Add("IsEdit", false);

        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AccommodationTypeDialog>("Add Accommodation Type", parameters, options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            var selectedCampsite = GetSelectedCampsite();
            if (selectedCampsite != null)
            {
                newAccommodation.Id = selectedCampsite.Pricing.Any() ? selectedCampsite.Pricing.Max(p => p.Id) + 1 : 1;
                selectedCampsite.Pricing.Add(newAccommodation);
                Snackbar.Add($"Accommodation type '{newAccommodation.Type}' added successfully", Severity.Success);
                StateHasChanged();
            }
        }
    }

    private async Task EditAccommodationType(BasePricingDto accommodation)
    {
        var parameters = new DialogParameters();
        parameters.Add("CampsiteName", GetSelectedCampsiteName());
        parameters.Add("AccommodationType", accommodation);
        parameters.Add("IsEdit", true);

        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Medium, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AccommodationTypeDialog>("Edit Accommodation Type", parameters, options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            Snackbar.Add($"Accommodation type '{accommodation.Type}' updated successfully", Severity.Success);
            StateHasChanged();
        }
    }

    private async Task DeleteAccommodationType(BasePricingDto accommodation)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Delete Accommodation Type",
            $"Are you sure you want to delete '{accommodation.Type}' ({accommodation.AvailableUnits} units)?",
            yesText: "Delete", cancelText: "Cancel");

        if (result == true)
        {
            var selectedCampsite = GetSelectedCampsite();
            if (selectedCampsite != null)
            {
                selectedCampsite.Pricing.Remove(accommodation);
                Snackbar.Add($"Accommodation type '{accommodation.Type}' deleted successfully", Severity.Success);
                StateHasChanged();
            }
        }
    }

    private void EditSeasonalPricing()
    {
        Snackbar.Add("Edit seasonal multipliers (applies to all campsites)", Severity.Info);
        // TODO: Open dialog to edit seasonal pricing
    }

    private void AddDiscount()
    {
        Snackbar.Add("Add new discount code", Severity.Info);
        // TODO: Open dialog to add new discount
    }

    private void EditDiscount(DiscountDto discount)
    {
        Snackbar.Add($"Edit discount: {discount.Code}", Severity.Info);
        // TODO: Open dialog to edit discount
    }

    private async Task DeleteDiscount(DiscountDto discount)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Delete Discount",
            $"Are you sure you want to delete discount code '{discount.Code}'?",
            yesText: "Delete", cancelText: "Cancel");

        if (result == true)
        {
            _discounts.Remove(discount);
            Snackbar.Add("Discount deleted successfully", Severity.Success);
            StateHasChanged();
        }
    }

    // Accommodation Peripheral Purchases Methods
    private void AddAccommodationPeripheralPurchase(BasePricingDto accommodation)
    {
        Snackbar.Add($"Add peripheral purchase for {accommodation.Type}", Severity.Info);
        // TODO: Open dialog to add new peripheral purchase for this accommodation type
    }

    private void EditAccommodationPeripheralPurchase(BasePricingDto accommodation, PeripheralPurchaseDto purchase)
    {
        Snackbar.Add($"Edit {purchase.Name} for {accommodation.Type}", Severity.Info);
        // TODO: Open dialog to edit peripheral purchase
    }

    private async Task DeleteAccommodationPeripheralPurchase(BasePricingDto accommodation, PeripheralPurchaseDto purchase)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Delete Peripheral Purchase",
            $"Are you sure you want to delete '{purchase.Name}' from {accommodation.Type}?",
            yesText: "Delete", cancelText: "Cancel");

        if (result == true)
        {
            accommodation.AccommodationPeripheralPurchases.Remove(purchase);
            Snackbar.Add($"Peripheral purchase '{purchase.Name}' deleted successfully", Severity.Success);
            StateHasChanged();
        }
    }

    // Campsite Peripheral Purchases Methods
    private List<PeripheralPurchaseDto> GetSelectedCampsitePeripheralPurchases()
    {
        var campsite = GetSelectedCampsite();
        return campsite?.PeripheralPurchases ?? new List<PeripheralPurchaseDto>();
    }

    private void AddPeripheralPurchase()
    {
        Snackbar.Add("Add new peripheral purchase", Severity.Info);
        // TODO: Open dialog to add new peripheral purchase
    }

    private void EditPeripheralPurchase(PeripheralPurchaseDto purchase)
    {
        Snackbar.Add($"Edit peripheral purchase: {purchase.Name}", Severity.Info);
        // TODO: Open dialog to edit peripheral purchase
    }

    private async Task DeletePeripheralPurchase(PeripheralPurchaseDto purchase)
    {
        bool? result = await DialogService.ShowMessageBox(
            "Delete Peripheral Purchase",
            $"Are you sure you want to delete '{purchase.Name}'?",
            yesText: "Delete", cancelText: "Cancel");

        if (result == true)
        {
            var selectedCampsite = GetSelectedCampsite();
            if (selectedCampsite != null)
            {
                selectedCampsite.PeripheralPurchases.Remove(purchase);
                Snackbar.Add($"Peripheral purchase '{purchase.Name}' deleted successfully", Severity.Success);
                StateHasChanged();
            }
        }
    }

    private string GetPeripheralPurchaseIcon(string name)
    {
        return name.ToLower() switch
        {
            var n when n.Contains("fishing") => Icons.Material.Filled.Phishing,
            var n when n.Contains("yoga") => Icons.Material.Filled.SelfImprovement,
            var n when n.Contains("brunch") || n.Contains("restaurant") => Icons.Material.Filled.Restaurant,
            var n when n.Contains("kayak") => Icons.Material.Filled.Kayaking,
            var n when n.Contains("volleyball") => Icons.Material.Filled.SportsVolleyball,
            var n when n.Contains("lighthouse") || n.Contains("tour") => Icons.Material.Filled.Tour,
            var n when n.Contains("bike") || n.Contains("rental") => Icons.Material.Filled.DirectionsBike,
            var n when n.Contains("hiking") => Icons.Material.Filled.Hiking,
            var n when n.Contains("campfire") || n.Contains("firewood") => Icons.Material.Filled.LocalFireDepartment,
            _ => Icons.Material.Filled.LocalActivity
        };
    }

    // DTOs
    private class CampsitePricingDto
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Region { get; set; } = string.Empty;
        public string Attractiveness { get; set; } = string.Empty;
        public List<BasePricingDto> Pricing { get; set; } = new();
        public List<PeripheralPurchaseDto> PeripheralPurchases { get; set; } = new();
    }

    private class BasePricingDto
    {
        public int Id { get; set; }
        public string Type { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public int AvailableUnits { get; set; }
        public int MaxGuests { get; set; }
        public bool IsActive { get; set; } = true;
        public List<PeripheralPurchaseDto> AccommodationPeripheralPurchases { get; set; } = new();
    }

    private class SeasonalMultiplierDto
    {
        public string Name { get; set; } = string.Empty;
        public string DateRange { get; set; } = string.Empty;
        public decimal Multiplier { get; set; }
    }

    private class DiscountDto
    {
        public string Code { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public string Type { get; set; } = string.Empty;
        public decimal Value { get; set; }
        public DateTime ValidFrom { get; set; }
        public DateTime ValidUntil { get; set; }
        public int UsedCount { get; set; }
        public int MaxUses { get; set; }
        public bool IsActive { get; set; }
    }

    private class PeripheralPurchaseDto
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string Description { get; set; } = string.Empty;
        public decimal Price { get; set; }
        public bool IsActive { get; set; } = true;
    }
}


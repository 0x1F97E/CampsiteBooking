@using MudBlazor
@using CampsiteBooking.Models.DTOs
@rendermode InteractiveServer

<MudDialog>
    <DialogContent>
        <MudContainer Style="max-height: 70vh; overflow-y: auto;">
            <MudForm @ref="_form" @bind-IsValid="@_isValid">
                <MudGrid>
                    <MudItem xs="12">
                        <MudAlert Severity="Severity.Info" Dense="true">
                            Managing accommodation type for <strong>@CampsiteName</strong>
                        </MudAlert>
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="AccommodationType.Type" Label="Accommodation Type" Variant="Variant.Outlined"
                                      Required="true" RequiredError="Type is required"
                                      Placeholder="e.g., Cabin, Tent Site, Glamping, RV Spot" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudNumericField @bind-Value="AccommodationType.AvailableUnits" Label="Available Units" Variant="Variant.Outlined"
                                        Required="true" RequiredError="Available units is required" Min="0"
                                        HideSpinButtons="false" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudTextField @bind-Value="AccommodationType.UnitNamingPrefix" Label="Unit Naming Prefix" Variant="Variant.Outlined"
                                      Placeholder="e.g., A, B, CAB" />
                    </MudItem>

                    <MudItem xs="12" md="6">
                        <MudSelect T="string" @bind-Value="AccommodationType.UnitNamingPattern" Label="Naming Pattern" Variant="Variant.Outlined">
                            <MudSelectItem T="string" Value="@("Letters")">Letters (A, B, C...)</MudSelectItem>
                            <MudSelectItem T="string" Value="@("Numbers")">Numbers (1, 2, 3...)</MudSelectItem>
                            <MudSelectItem T="string" Value="@("PrefixNumbers")">Prefix + Numbers (A1, A2...)</MudSelectItem>
                        </MudSelect>
                    </MudItem>

                    <MudItem xs="12">
                        <MudTextField @bind-Value="AccommodationType.Description" Label="Description" Variant="Variant.Outlined"
                                      Lines="4" Required="true" RequiredError="Description is required"
                                      Placeholder="Describe this accommodation type, its features, and what makes it special..." />
                    </MudItem>

                    <MudItem xs="12" md="4">
                        <MudNumericField @bind-Value="AccommodationType.MaxCapacity" Label="Maximum Capacity (persons)" Variant="Variant.Outlined"
                                        Required="true" RequiredError="Capacity is required" Min="1"
                                        HideSpinButtons="false" />
                    </MudItem>

                    <MudItem xs="12" md="4">
                        <MudNumericField @bind-Value="AccommodationType.PricePerNight" Label="Price Per Night ($)" Variant="Variant.Outlined"
                                        Required="true" RequiredError="Price is required" Min="0" Format="N2"
                                        HideSpinButtons="false" />
                    </MudItem>

                    <MudItem xs="12" md="4">
                        <MudNumericField @bind-Value="AccommodationType.AreaSquareMeters" Label="Area (mÂ²)" Variant="Variant.Outlined"
                                        Min="0" Step="0.1m" Format="N1" Clearable="true"
                                        HelperText="Optional - size in square meters"
                                        HideSpinButtons="false" />
                    </MudItem>

                    <MudItem xs="12">
                        <MudTextField @bind-Value="AccommodationType.ImageUrl" Label="Image URL" Variant="Variant.Outlined"
                                      Placeholder="https://example.com/image.jpg" />
                    </MudItem>

                    @if (!string.IsNullOrWhiteSpace(AccommodationType.ImageUrl))
                    {
                        <MudItem xs="12">
                            <MudText Typo="Typo.subtitle2" GutterBottom="true">Image Preview:</MudText>
                            <MudImage Src="@AccommodationType.ImageUrl" Alt="Accommodation preview"
                                      Height="200" ObjectFit="ObjectFit.Cover" Class="rounded" />
                        </MudItem>
                    }

                    <MudItem xs="12">
                        <MudSelect T="string" @bind-Value="AccommodationType.Icon"
                                   Label="Icon"
                                   Variant="Variant.Outlined"
                                   Clearable="true"
                                   HelperText="Choose an icon to represent this accommodation type">
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Cabin">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Cabin" Class="mr-2" />
                                    <span>Cabin</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Landscape">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Landscape" Class="mr-2" />
                                    <span>Tent / Landscape</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.RvHookup">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.RvHookup" Class="mr-2" />
                                    <span>RV / Caravan</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.NightShelter">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.NightShelter" Class="mr-2" />
                                    <span>Glamping / Shelter</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Home">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Home" Class="mr-2" />
                                    <span>Home / House</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Cottage">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Cottage" Class="mr-2" />
                                    <span>Cottage</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.House">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.House" Class="mr-2" />
                                    <span>House</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Villa">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Villa" Class="mr-2" />
                                    <span>Villa</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Apartment">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Apartment" Class="mr-2" />
                                    <span>Apartment</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Bungalow">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Bungalow" Class="mr-2" />
                                    <span>Bungalow</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Houseboat">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Houseboat" Class="mr-2" />
                                    <span>Houseboat</span>
                                </div>
                            </MudSelectItem>
                            <MudSelectItem T="string" Value="@Icons.Material.Filled.Park">
                                <div class="d-flex align-center">
                                    <MudIcon Icon="@Icons.Material.Filled.Park" Class="mr-2" />
                                    <span>Park</span>
                                </div>
                            </MudSelectItem>
                        </MudSelect>
                    </MudItem>

                    <MudItem xs="12">
                        <MudSwitch @bind-Value="AccommodationType.IsActive" Label="Active" Color="Color.Success" />
                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                            Inactive accommodation types won't be available for booking
                        </MudText>
                    </MudItem>
                </MudGrid>
            </MudForm>
        </MudContainer>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Primary" Variant="Variant.Filled" OnClick="Submit" Disabled="@(!_isValid)">
            @(IsEdit ? "Update" : "Add") Accommodation Type
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter] public string CampsiteName { get; set; } = string.Empty;
    [Parameter] public AccommodationTypeDto AccommodationType { get; set; } = new();
    [Parameter] public bool IsEdit { get; set; }

    private MudForm _form = null!;
    private bool _isValid;

    private void Submit()
    {
        MudDialog.Close(DialogResult.Ok(AccommodationType));
    }

    private void Cancel() => MudDialog.Cancel();
}

